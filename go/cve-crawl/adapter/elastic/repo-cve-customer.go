package elastic

import (
	"context"

	"gitlab.viettelcyber.com/awesome-threat/library/adapter/elastic"

	"cve-crawler/defs"
	"cve-crawler/model"
)

type cveCustomerRepository struct {
	con elastic.Service
}

func NewCVECustomerRepository(conf elastic.Config) CVECustomerRepository {
	// Success
	return &cveCustomerRepository{con: elastic.NewService(conf)}
}

func (inst *cveCustomerRepository) Name() string {
	// Success
	return defs.IndexCveCustomer
}

func (inst *cveCustomerRepository) StoreMany(ctx context.Context, documents []*model.CveCustomer) error {
	docs := make([]elastic.Document, len(documents))
	for i, doc := range documents {
		docs[i] = doc
	}
	if err := inst.con.InsertMany(inst.Name(), "", docs); err != nil {
		return err
	}
	// Success
	return nil
}
