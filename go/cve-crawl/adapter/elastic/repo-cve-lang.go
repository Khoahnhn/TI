package elastic

import (
	"context"
	"fmt"

	"cve-crawler/defs"
	"cve-crawler/model"

	"gitlab.viettelcyber.com/awesome-threat/library/adapter/elastic"
)

type cveLangRepository struct {
	language string
	model    elastic.Service
}

func NewCVELangRepository(config elastic.Config) CVELangRepository {
	// Success
	return &cveLangRepository{model: elastic.NewService(config), language: "*"}
}

func (inst *cveLangRepository) Name() string {
	// Success
	return fmt.Sprintf(defs.IndexCVELang, inst.language)
}

func (inst *cveLangRepository) SetLang(lang string) {
	if lang == "" {
		inst.language = "*"
	} else {
		inst.language = lang
	}
}

func (inst *cveLangRepository) GetByID(ctx context.Context, id string) (*model.CVELang, error) {
	var document model.CVELang
	if err := inst.model.Get(inst.Name(), "", id, &document); err != nil {
		return nil, err
	}
	// Success
	return &document, nil
}
